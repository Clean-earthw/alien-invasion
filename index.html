<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Space Defender VR - Alien Invasion</title>

    <link rel="icon" type="image/x-icon" href="/public/favicon.ico" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Montserrat:wght@400;600;700;900&family=Roboto:wght@300;400&display=swap" rel="stylesheet">

    <style>
      /* --- 1. RESET & CORE --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body, html {
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: 'Roboto', sans-serif;
        color: white;
        background-color: #000;
      }

      /* --- 2. BACKGROUND SLIDER --- */
      #bg-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 5000 !important; /* High Z-Index to cover canvas */
      }

      .bg-slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0;
        transition: opacity 1.5s ease-in-out;
      }

      .bg-slide.active {
        opacity: 1;
      }

      /* Dark Overlay to make text pop */
      .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(0, 10, 30, 0.85) 0%, rgba(0, 0, 0, 0.9) 100%);
        z-index: 1;
      }

      /* Loading Screen */
      #loading {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        font-family: 'Orbitron', sans-serif;
      }

      .loading-content {
        text-align: center;
        padding: 40px;
        border-radius: 20px;
        background: rgba(0, 20, 40, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 150, 255, 0.3);
        box-shadow: 0 0 40px rgba(0, 150, 255, 0.2);
      }

      .loading-title {
        font-size: 32px;
        margin-bottom: 20px;
        color: #00d4ff;
        text-shadow: 0 0 20px rgba(0, 212, 255, 0.7);
      }

      .loading-bar {
        width: 300px;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        margin: 30px auto;
        overflow: hidden;
      }

      .loading-progress {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #00d4ff, #0088ff);
        border-radius: 2px;
        transition: width 0.3s ease;
      }

      /* --- 3. LANDING CONTENT --- */
      #landing-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999 !important; /* Highest Z-Index */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        transition: opacity 0.8s ease;
        padding: 20px;
        box-sizing: border-box;
      }

      #landing-content.hidden {
        opacity: 0;
        pointer-events: none;
      }

      /* --- 4. TYPOGRAPHY --- */
      .nav-bar {
        position: absolute;
        top: 40px;
        left: 50px;
        font-family: 'Orbitron', sans-serif;
        font-weight: 700;
        font-size: 28px;
        letter-spacing: 2px;
        display: flex;
        align-items: center;
        gap: 15px;
        z-index: 10000; /* Above everything */
      }

      .logo-icon {
        font-size: 36px;
        color: #00d4ff;
        text-shadow: 0 0 15px rgba(0, 212, 255, 0.7);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }

      .small-title {
        font-family: 'Montserrat', sans-serif;
        font-size: 16px;
        letter-spacing: 4px;
        text-transform: uppercase;
        margin-bottom: 25px;
        font-weight: 600;
        color: #00d4ff;
        text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
      }

      .main-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 6rem;
        font-weight: 900;
        text-transform: uppercase;
        margin-bottom: 30px;
        line-height: 1.1;
        letter-spacing: 3px;
        background: linear-gradient(135deg, #00d4ff 0%, #0088ff 50%, #0044ff 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 40px rgba(0, 212, 255, 0.3);
      }

      .subtitle {
        font-size: 20px;
        max-width: 700px;
        line-height: 1.7;
        margin-bottom: 60px;
        color: #b8e2ff;
        font-weight: 300;
        background: rgba(0, 20, 40, 0.5);
        padding: 25px 40px;
        border-radius: 15px;
        border: 1px solid rgba(0, 150, 255, 0.3);
        backdrop-filter: blur(10px);
      }

      /* --- 5. BUTTON --- */
      .enter-btn {
        padding: 22px 55px;
        font-family: 'Orbitron', sans-serif;
        font-size: 16px;
        font-weight: 700;
        color: #000;
        background: linear-gradient(135deg, #00d4ff 0%, #0088ff 100%);
        border: none;
        border-radius: 12px;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 2px;
        transition: all 0.3s ease;
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
        position: relative;
        overflow: hidden;
      }

      .enter-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 0 50px rgba(0, 212, 255, 0.8);
        background: linear-gradient(135deg, #00e6ff 0%, #0099ff 100%);
      }

      .enter-btn:active {
        transform: translateY(-2px) scale(1.02);
      }

      .enter-btn::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transform: rotate(45deg);
        animation: shine 3s infinite;
      }

      @keyframes shine {
        0% { transform: translateX(-100%) rotate(45deg); }
        100% { transform: translateX(100%) rotate(45deg); }
      }

      /* Stats Cards */
      .stats-container {
        display: flex;
        gap: 20px;
        margin-top: 40px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .stat-card {
        background: rgba(0, 30, 60, 0.7);
        padding: 20px 30px;
        border-radius: 12px;
        border: 1px solid rgba(0, 150, 255, 0.2);
        min-width: 180px;
        backdrop-filter: blur(10px);
      }

      .stat-value {
        font-family: 'Orbitron', sans-serif;
        font-size: 32px;
        font-weight: 700;
        color: #00d4ff;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 14px;
        color: #88c4ff;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* --- 3D CONTAINER --- */
      #scene-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1; /* Starts below UI */
        pointer-events: none; /* Let clicks pass through until activated */
      }

      /* Game UI Elements (will be shown after game starts) */
      #game-ui {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        pointer-events: none;
      }

      /* ==================== RESPONSIVE STYLES ==================== */

      /* Tablet Devices (768px - 1024px) */
      @media screen and (max-width: 1024px) {
        .nav-bar {
          left: 30px;
          top: 30px;
          font-size: 24px;
        }
        
        .logo-icon {
          font-size: 30px;
        }
        
        .main-title {
          font-size: 5rem;
          margin-bottom: 25px;
        }
        
        .subtitle {
          font-size: 18px;
          max-width: 650px;
          margin-bottom: 50px;
          padding: 20px 30px;
        }
        
        .enter-btn {
          padding: 20px 50px;
          font-size: 15px;
        }
        
        .stat-card {
          min-width: 160px;
          padding: 15px 25px;
        }
        
        .stat-value {
          font-size: 28px;
        }
      }

      /* Mobile Landscape & Small Tablets (576px - 768px) */
      @media screen and (max-width: 768px) {
        .nav-bar {
          left: 20px;
          top: 25px;
          font-size: 22px;
        }
        
        .logo-icon {
          font-size: 28px;
        }
        
        .main-title {
          font-size: 4rem;
          margin-bottom: 20px;
        }
        
        .small-title {
          font-size: 14px;
          letter-spacing: 3px;
          margin-bottom: 15px;
        }
        
        .subtitle {
          font-size: 17px;
          max-width: 550px;
          margin-bottom: 45px;
          padding: 20px;
        }
        
        .enter-btn {
          padding: 18px 45px;
          font-size: 14px;
        }
        
        .stats-container {
          flex-direction: column;
          align-items: center;
          gap: 15px;
        }
        
        .stat-card {
          width: 80%;
          max-width: 300px;
        }
      }

      /* Mobile Portrait (up to 576px) */
      @media screen and (max-width: 576px) {
        .nav-bar {
          left: 15px;
          top: 20px;
          font-size: 20px;
          gap: 10px;
        }
        
        .logo-icon {
          font-size: 26px;
        }
        
        .main-title {
          font-size: 3rem;
          margin-bottom: 15px;
          letter-spacing: 2px;
          padding: 0 15px;
        }
        
        .small-title {
          font-size: 13px;
          letter-spacing: 2.5px;
          margin-bottom: 12px;
        }
        
        .subtitle {
          font-size: 16px;
          max-width: 90%;
          margin-bottom: 40px;
          line-height: 1.6;
          padding: 18px;
        }
        
        .enter-btn {
          padding: 16px 40px;
          font-size: 13px;
          min-width: 240px;
        }
        
        #landing-content {
          padding: 15px;
        }
        
        .loading-title {
          font-size: 24px;
        }
        
        .loading-bar {
          width: 250px;
        }
      }

      /* Very Small Mobile Devices (up to 360px) */
      @media screen and (max-width: 360px) {
        .nav-bar {
          font-size: 18px;
          left: 12px;
          top: 15px;
        }
        
        .logo-icon {
          font-size: 24px;
        }
        
        .main-title {
          font-size: 2.5rem;
          margin-bottom: 12px;
        }
        
        .small-title {
          font-size: 12px;
          letter-spacing: 2px;
        }
        
        .subtitle {
          font-size: 15px;
          margin-bottom: 35px;
          padding: 15px;
        }
        
        .enter-btn {
          padding: 14px 35px;
          font-size: 12px;
          min-width: 220px;
        }
        
        .stat-value {
          font-size: 24px;
        }
      }

      /* Height-based adjustments for very tall/short screens */
      @media screen and (max-height: 600px) {
        #landing-content {
          justify-content: flex-start;
          padding-top: 120px;
        }
        
        .main-title {
          font-size: 4rem;
          margin-bottom: 20px;
        }
        
        .subtitle {
          margin-bottom: 40px;
          padding: 15px;
        }
        
        .nav-bar {
          top: 20px;
        }
        
        .stats-container {
          margin-top: 30px;
        }
      }

      /* Prevent text from becoming too small on very small screens */
      @media screen and (max-width: 300px) {
        .main-title {
          font-size: 2rem;
        }
        
        .small-title {
          font-size: 11px;
          letter-spacing: 1.5px;
        }
        
        .subtitle {
          font-size: 14px;
        }
        
        .enter-btn {
          padding: 12px 30px;
          font-size: 11px;
          min-width: 200px;
        }
      }
    </style>
  </head>
  <body>

    <!-- Loading Screen -->
    <div id="loading">
      <div class="loading-content">
        <div class="logo-icon">ðŸš€</div>
        <h1 class="loading-title">LOADING SPACE DEFENDER</h1>
        <div class="loading-bar">
          <div class="loading-progress"></div>
        </div>
        <p style="color: #88c4ff;">Initializing hyperspace engines...</p>
      </div>
    </div>

    <!-- Background Slider -->
    <div id="bg-container">
       <!-- Space-themed backgrounds -->
       <div class="bg-slide active" style="background-image: url('https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2071&q=80');"></div> 
       <div class="bg-slide" style="background-image: url('https://images.unsplash.com/photo-1502134249126-9f3755a50d78?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');"></div> 
       <div class="bg-slide" style="background-image: url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2027&q=80');"></div> 
       <div class="overlay"></div>
    </div>

    <!-- Navigation -->
    <div class="nav-bar">
      <span class="logo-icon">ðŸ›¸</span> SPACE DEFENDER
    </div>

    <!-- Main Content -->
    <div id="landing-content">
      <p class="small-title">VR IMMERSIVE DEFENSE GAME</p>
      <h1 class="main-title">ALIEN INVASION</h1>
      <p class="subtitle">
        You are the last line of defense for the spaceship Hyperion. Alien forces are attacking through hyperspace portals. 
        Grab the energy cannon and defend the ship before they breach the hull!
      </p>
      
      <button id="enter-btn" class="enter-btn">ENTER VR BATTLEFIELD</button>
      
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-value">5</div>
          <div class="stat-label">Waves to Survive</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">40</div>
          <div class="stat-label">Energy Ammo</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">100%</div>
          <div class="stat-label">Hull Integrity</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">âˆž</div>
          <div class="stat-label">Aliens to Destroy</div>
        </div>
      </div>
    </div>

    <!-- 3D Container -->
    <div id="scene-container"></div>

    <!-- Game UI (Hidden initially) -->
    <div id="game-ui" style="display: none;"></div>

    <!-- MAIN SCRIPT: Handles UI and Starts App on Click -->
    <script type="module">
      // Import the start function
      import { startExperience } from "./src/index.ts";

      const btn = document.getElementById('enter-btn');
      const content = document.getElementById('landing-content');
      const navBar = document.querySelector('.nav-bar');
      const bgContainer = document.getElementById('bg-container');
      const sceneContainer = document.getElementById('scene-container');
      const loadingScreen = document.getElementById('loading');
      const loadingProgress = document.querySelector('.loading-progress');
      
      // Simulate loading progress
      let progress = 0;
      const loadingInterval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress > 90) {
          clearInterval(loadingInterval);
          progress = 100;
        }
        if (loadingProgress) {
          loadingProgress.style.width = progress + '%';
        }
      }, 300);

      // --- SLIDER LOGIC ---
      const slides = document.querySelectorAll('.bg-slide');
      let currentSlide = 0;
      function nextSlide() {
        slides[currentSlide].classList.remove('active');
        currentSlide = (currentSlide + 1) % slides.length;
        slides[currentSlide].classList.add('active');
      }
      setInterval(nextSlide, 5000);

      // --- ENTER LOGIC ---
      btn.addEventListener('click', async () => {
        console.log("ðŸš€ User Clicked Enter - Starting Space Defense VR...");

        // 1. Hide loading screen
        if (loadingScreen) {
          loadingScreen.style.transition = "opacity 0.5s ease";
          loadingScreen.style.opacity = "0";
          setTimeout(() => {
            loadingScreen.style.display = "none";
          }, 500);
        }

        // 2. Fade out UI with effects
        content.style.transition = "all 0.8s cubic-bezier(0.4, 0, 0.2, 1)";
        content.style.opacity = "0";
        content.style.transform = "translateY(50px)";
        
        if(navBar) {
          navBar.style.transition = "opacity 0.8s ease";
          navBar.style.opacity = "0";
        }
        
        // 3. Fade out Background with starfield effect
        setTimeout(() => {
          bgContainer.style.transition = "opacity 1.5s ease, filter 2s ease";
          bgContainer.style.opacity = "0";
          bgContainer.style.filter = "blur(20px)";
          
          // Create hyperspace effect
          const hyperspaceEffect = document.createElement('div');
          hyperspaceEffect.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
              #000 0%, 
              #001133 20%, 
              #003366 40%, 
              #0066cc 60%, 
              #00d4ff 80%, 
              #ffffff 100%);
            z-index: 9998;
            opacity: 0;
            animation: hyperspace 1.5s ease-out;
          `;
          
          document.body.appendChild(hyperspaceEffect);
          
          // Define hyperspace animation
          const style = document.createElement('style');
          style.textContent = `
            @keyframes hyperspace {
              0% { opacity: 0; transform: scale(0.8); filter: blur(0px); }
              50% { opacity: 1; transform: scale(1.2); filter: blur(20px); }
              100% { opacity: 0; transform: scale(3); filter: blur(50px); }
            }
          `;
          document.head.appendChild(style);
          
          // Remove from DOM to save performance
          setTimeout(() => {
            bgContainer.remove();
            hyperspaceEffect.remove();
            style.remove();
          }, 2000);
        }, 800);

        // 4. Enable pointer events for the 3D scene
        sceneContainer.style.pointerEvents = "auto";
        
        // 5. Initialize the 3D World!
        try {
          await startExperience();
        } catch (error) {
          console.error("Failed to start experience:", error);
          // Show error message
          const errorDiv = document.createElement('div');
          errorDiv.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 100000;
            font-family: 'Orbitron', sans-serif;
          `;
          errorDiv.innerHTML = `
            <h2>ðŸš¨ INITIALIZATION FAILED</h2>
            <p>${error.message || 'Unknown error occurred'}</p>
            <button onclick="location.reload()" style="
              margin-top: 20px;
              padding: 10px 20px;
              background: white;
              color: #ff0000;
              border: none;
              border-radius: 5px;
              cursor: pointer;
              font-weight: bold;
            ">ðŸ”„ RETRY</button>
          `;
          document.body.appendChild(errorDiv);
        }

        // 6. Unlock Audio
        if (window.AudioContext || window.webkitAudioContext) {
           const AudioContext = window.AudioContext || window.webkitAudioContext;
           const audioContext = new AudioContext();
           if (audioContext.state === 'suspended') {
             audioContext.resume();
           }
           
           // Create a silent audio node to keep audio context alive
           const oscillator = audioContext.createOscillator();
           const gainNode = audioContext.createGain();
           gainNode.gain.value = 0.001;
           oscillator.connect(gainNode);
           gainNode.connect(audioContext.destination);
           oscillator.start();
           oscillator.stop(audioContext.currentTime + 0.001);
        }
      });

      // Auto-hide loading screen after 3 seconds if user doesn't click
      setTimeout(() => {
        if (loadingScreen && loadingScreen.style.display !== 'none') {
          loadingScreen.style.transition = "opacity 0.5s ease";
          loadingScreen.style.opacity = "0";
          setTimeout(() => {
            loadingScreen.style.display = "none";
          }, 500);
        }
      }, 3000);
    </script>
  </body>
</html>